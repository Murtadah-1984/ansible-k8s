# ============================================================================
# VERSION CONFIGURATION
# ============================================================================
# Source: group_vars/all.yml (original)
kubernetes_version: "1.34"
containerd_version: "2.2.0"
cni_version: "v1.3.0"
crictl_version: "v1.34.0"

# ============================================================================
# NODE CONFIGURATION
# ============================================================================
# Source: group_vars/all.yml (original)
node_hostname: "{{ inventory_hostname }}"
timezone: "Asia/Baghdad"

# ============================================================================
# MONITORING CONFIGURATION
# ============================================================================
# Source: group_vars/all.yml (original)
loki_host: "loki.default.svc"
loki_port: 3100

# ============================================================================
# CLUSTER BOOTSTRAP CONFIGURATION
# ============================================================================
# Source: cluster-bootstrap.yml
cluster_name: "kubernetes"
pod_network_cidr: "10.244.0.0/16"
service_cidr: "10.96.0.0/12"
control_plane_endpoint: ""  # Set to "k8s-api.example.com:6443" if using load balancer
cni_plugin: "calico"  # Options: calico, flannel
allow_pods_on_control_plane: false  # Set to true to allow pods on control plane nodes
node_bootstrap_serial: "50%"  # Serial execution percentage for node bootstrap

# ============================================================================
# LOAD BALANCER CONFIGURATION
# ============================================================================
# Source: install-lb-services.yml
# Control plane nodes for HAProxy backend (dynamically built from inventory)
# This builds a list of dicts with 'name' and 'ip' from the [control] group in inventory.ini
# Note: This will be set dynamically in the playbook if not defined here
control_plane_nodes: []

# Keepalived configuration (set in inventory.ini)
# keepalived_virtual_ip is defined in inventory.ini [all:vars] section
keepalived_virtual_router_id: 51
keepalived_auth_pass: "k8sHaSecret42"
keepalived_interface: ""  # Will be auto-detected if not set (uses ansible_default_ipv4.interface)

# ============================================================================
# KUBEADM JOIN CONFIGURATION
# ============================================================================
# Source: kubeadm-join-nodes.yml
# These are typically provided at runtime via -e or prompted
join_token: ""  # e.g., "abc123.def4567890abcdef"
discovery_token_ca_cert_hash: ""  # e.g., "sha256:1234567890abcdef..."
api_server_endpoint: ""  # e.g., "10.0.20.11:6443" or "k8s-cp-01:6443"
auto_fetch_join_info: false  # Auto-fetch join info from control plane (requires kubectl access)
control_plane_host: "k8s-cp-01"  # Control plane node to fetch info from
node_labels: []  # Optional: node labels for join command
node_taints: []  # Optional: node taints for join command
skip_if_already_joined: true  # Skip if node is already part of the cluster

# ============================================================================
# CLUSTER RESET CONFIGURATION
# ============================================================================
# Source: reset-kubernetes-cluster.yml
perform_reset: false  # Safety flag - set to true to actually perform reset
remove_kubeconfig: false  # Remove ~/.kube config during reset (default: false)

# ============================================================================
# KUBELET CONFIGURATION
# ============================================================================
# Source: group_vars/all.yml (original), roles/kubernetes/templates
kubelet_client_ca_file: "/etc/kubernetes/pki/ca.crt"
kubelet_streaming_connection_idle_timeout: "5m"
kubelet_event_record_qps: 5
kubelet_pod_pids_limit: 4096
kubelet_cluster_domain: "cluster.local"
kubelet_cluster_dns: "10.96.0.10"
# Optional: TLS certificate configuration (if certificates are provided)
# kubelet_tls_cert_file: "/path/to/cert"
# kubelet_tls_private_key_file: "/path/to/key"

# ============================================================================
# HARDENING CONFIGURATION
# ============================================================================
# Source: roles/hardening/defaults/main.yml
grub_password_hash: 'CHANGE_ME'  # Generate with: grub-mkpasswd-pbkdf2, leave as 'CHANGE_ME' to skip
disable_swap: true  # Disable swap (required for Kubernetes)
kubernetes_ports:
  - "10250"
  - "10256"
  - "30000:32767"

# ============================================================================
# CONTAINERD CONFIGURATION
# ============================================================================
# Source: roles/containerd/templates/config.toml.j2
containerd_sandbox_image: "registry.k8s.io/pause:3.9"  # Pause container image
