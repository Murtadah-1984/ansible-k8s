---
# Password Policy Configuration
# Configures password quality requirements per CIS STIG UBTU-24-100600

# ============================================================================
# PASSWORD POLICY CONFIGURATION
# ============================================================================
# Configure password quality requirements per CIS STIG UBTU-24-100600

- name: Configure password quality (UBTU-24-100600)
  lineinfile:
    path: /etc/security/pwquality.conf
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
    create: true
  loop:
    - { regexp: '^#?minlen', line: 'minlen = 14' }
    - { regexp: '^#?dcredit', line: 'dcredit = -1' }
    - { regexp: '^#?ucredit', line: 'ucredit = -1' }
    - { regexp: '^#?ocredit', line: 'ocredit = -1' }
    - { regexp: '^#?lcredit', line: 'lcredit = -1' }

- name: Configure PAM password quality
  lineinfile:
    path: /etc/pam.d/common-password
    regexp: '^password\s+requisite\s+pam_pwquality\.so'
    line: 'password requisite pam_pwquality.so retry=3'
    insertafter: '^password.*pam_unix\.so'
    create: true

