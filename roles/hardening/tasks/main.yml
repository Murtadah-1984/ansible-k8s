---
# CIS Ubuntu 24.04 LTS STIG Hardening Role
# Implements automated recommendations from CIS Ubuntu Linux 24.04 LTS STIG Benchmark v1.0.0
#
# Prerequisites:
# - Ubuntu 24.04 LTS
# - Root or sudo access
# - Ansible 2.9+
# - common role should run first
#
# Usage:
#   ansible-playbook -i inventory.ini playbook.yml
#
# Variables:
#   - grub_password_hash: GRUB bootloader password hash (default: 'CHANGE_ME')
#   - disable_swap: Disable swap for Kubernetes (default: true)
#   - kubernetes_ports: List of Kubernetes ports to allow through UFW (default: ['10250', '10256', '30000:32767'])

# ============================================================================
# PACKAGE MANAGEMENT
# ============================================================================
- name: Manage packages (removal and installation)
  include_tasks: packages.yml

# ============================================================================
# SYSTEM CONFIGURATION
# ============================================================================
- name: Configure system settings (hostname, postfix)
  include_tasks: system_config.yml

# ============================================================================
# SERVICE CONFIGURATION
# ============================================================================
- name: Configure and manage services
  include_tasks: services.yml

# ============================================================================
# FIREWALL CONFIGURATION
# ============================================================================
- name: Configure UFW firewall
  include_tasks: firewall.yml

# ============================================================================
# FILE INTEGRITY MONITORING
# ============================================================================
- name: Configure AIDE for file integrity monitoring
  include_tasks: aide.yml

# ============================================================================
# SSH CONFIGURATION
# ============================================================================
- name: Configure SSH daemon and client
  include_tasks: ssh.yml

# ============================================================================
# SYSTEM LIMITS AND SESSION MANAGEMENT
# ============================================================================
- name: Configure system limits and session timeouts
  include_tasks: limits.yml

# ============================================================================
# BOOT SECURITY CONFIGURATION
# ============================================================================
- name: Configure GRUB bootloader security
  include_tasks: boot.yml

# ============================================================================
# FILE PERMISSIONS
# ============================================================================
- name: Set correct file permissions
  include_tasks: permissions.yml

# ============================================================================
# PASSWORD POLICY CONFIGURATION
# ============================================================================
- name: Configure password quality requirements
  include_tasks: password.yml

# ============================================================================
# NETWORK SECURITY CONFIGURATION
# ============================================================================
- name: Configure network security parameters
  include_tasks: network.yml

# ============================================================================
# SWAP CONFIGURATION
# ============================================================================
- name: Disable swap for Kubernetes
  include_tasks: swap.yml
