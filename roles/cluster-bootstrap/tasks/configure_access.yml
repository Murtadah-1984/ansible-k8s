---
# Configure Cluster Access
# This task file configures cluster access and displays cluster information

- name: Display cluster information
  debug:
    msg:
      - "Kubernetes cluster has been successfully bootstrapped!"
      - "Control plane endpoint: {{ control_plane_endpoint if control_plane_endpoint else (groups['control'][0] + ':6443') }}"
      - "To access the cluster, copy /etc/kubernetes/admin.conf to your local machine:"
      - "  scp {{ ansible_user }}@{{ ansible_default_ipv4.address }}:/etc/kubernetes/admin.conf ~/.kube/config"
      - "  kubectl get nodes"

- name: Get cluster nodes
  command: kubectl get nodes -o wide
  register: cluster_nodes
  environment:
    KUBECONFIG: /root/.kube/config
  changed_when: false

- name: Display cluster nodes
  debug:
    var: cluster_nodes.stdout_lines

