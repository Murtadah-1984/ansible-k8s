[SERVICE]
    Flush        1
    Daemon       Off
    Log_Level    info
    Parsers_File parsers.conf

# ============================
# INPUT: Container Logs
# ============================
[INPUT]
    Name              tail
    Tag               kube.*
    Path              /var/log/containers/*.log
    Parser            docker
    DB                /var/log/flb_kube.db
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On
    Refresh_Interval  5
    Docker_Mode       On

# ============================
# FILTER: Add Kubernetes Metadata
# ============================
[FILTER]
    Name                 kubernetes
    Match                kube.*
    Kube_Tag_Prefix      kube.var.log.containers.
    Merge_Log            On
    Keep_Log             Off
    K8S-Logging.Parser   On
    K8S-Logging.Exclude  On

# ============================
# OUTPUT: Loki
# ============================
[OUTPUT]
    Name                  loki
    Match                 *
    Host                  {{ loki_host }}
    Port                  {{ loki_port }}
    TenantID              ""
    Labels                {job="fluentbit", node="{{ ansible_hostname }}"}
    Auto_Kubernetes_Labels On

